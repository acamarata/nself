# v0.4.9 Planning - Polish & nself-admin Integration

**Target**: Q4 2026
**Focus**: Bug fixes, stability, and admin UI integration

**Depends on**: v0.4.3-v0.4.8 (all features complete)

---

## Overview

Final polish release before v0.5.0. Focus on bug fixes, stability improvements, comprehensive testing, and deep integration between nself CLI and nself-admin UI.

---

## Focus Areas

### 1. Bug Fixes & Stability

#### Known Issues to Address
- Gather all GitHub issues
- Address edge cases in deployment
- Fix platform-specific bugs
- Resolve race conditions
- Handle error states gracefully

#### Error Handling Improvements
```bash
# Better error messages
nself deploy prod
# Before: Error: Connection refused
# After:  Error: Cannot connect to prod server (192.168.1.100:22)
#         Possible causes:
#         - Server is not running
#         - SSH port is blocked by firewall
#         - Wrong IP address in environments/prod/server.json
#
#         Run 'nself deploy prod --diagnose' for detailed checks

# Actionable suggestions
nself start
# Before: Error: Port 5432 already in use
# After:  Error: Port 5432 is already in use by another process
#
#         To fix:
#         1. Stop the conflicting process: lsof -i :5432
#         2. Or use a different port: POSTGRES_PORT=5433 nself start
#         3. Or let nself find an available port: nself start --auto-port
```

#### Recovery Mechanisms
```bash
# Automatic recovery from common issues
nself start --recover      # Attempt to recover from failed state
nself doctor --fix-all     # Fix all detected issues
nself reset --safe         # Safe reset preserving data
```

---

### 2. nself-admin Integration

#### CLI-to-Admin Communication

```bash
# Start admin with real-time CLI status
nself admin start

# Admin receives:
# - All running containers and health
# - Log streams from all services
# - Metrics from monitoring stack
# - Environment variables (masked)
# - Recent CLI commands
```

#### Admin API Endpoints

```
GET  /api/status              # Overall system status
GET  /api/services            # All services with health
GET  /api/services/:id        # Service details
POST /api/services/:id/restart # Restart service
GET  /api/logs/:service       # Service logs
WS   /api/logs/:service/stream # Real-time log stream
GET  /api/metrics             # Prometheus metrics
GET  /api/alerts              # Active alerts
GET  /api/env                 # Environment info (masked)
POST /api/commands            # Execute CLI commands
```

#### Features for nself-admin v0.1

| Feature | Description |
|---------|-------------|
| **Dashboard** | System overview, health, resources |
| **Services** | List, start, stop, restart, logs |
| **Logs** | Real-time log viewer with search |
| **Metrics** | Grafana-like metrics visualization |
| **Alerts** | Alert configuration and history |
| **Database** | Basic DB management UI |
| **Backups** | Backup/restore UI |
| **Users** | User management (via Hasura) |
| **Config** | Environment configuration editor |
| **Terminal** | Web terminal for CLI access |

#### Admin Dashboard Components

```
┌─────────────────────────────────────────────────────────────────────┐
│ nself Admin - myapp (production)                           [?] [⚙]  │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │
│  │   Services   │  │    Memory    │  │     CPU      │             │
│  │    12/12     │  │   4.2 GB     │  │     34%      │             │
│  │   healthy    │  │   of 8 GB    │  │   of 4 cores │             │
│  └──────────────┘  └──────────────┘  └──────────────┘             │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │ Services                                              [+ Add] │  │
│  ├─────────────────────────────────────────────────────────────┤  │
│  │ ● postgres      Running   256MB    0.5%   Port 5432         │  │
│  │ ● hasura        Running   512MB    2.1%   Port 8080         │  │
│  │ ● auth          Running   128MB    0.8%   Port 4000         │  │
│  │ ● api           Running   384MB    3.2%   Port 8001         │  │
│  │ ● redis         Running    64MB    0.1%   Port 6379         │  │
│  │ ○ worker        Starting  128MB    1.5%   -                 │  │
│  └─────────────────────────────────────────────────────────────┘  │
│                                                                     │
│  ┌──────────────────────────┐  ┌──────────────────────────────┐  │
│  │ Recent Logs              │  │ Alerts                       │  │
│  ├──────────────────────────┤  ├──────────────────────────────┤  │
│  │ [api] GET /users 200 12ms│  │ ⚠ High memory on postgres   │  │
│  │ [api] POST /auth 201 45ms│  │ ℹ Backup completed          │  │
│  │ [hasura] query users     │  │                              │  │
│  │ [auth] token refresh     │  │                              │  │
│  └──────────────────────────┘  └──────────────────────────────┘  │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

### 3. CLI Improvements

#### Command Completion

```bash
# Install completions
nself completion bash >> ~/.bashrc
nself completion zsh >> ~/.zshrc
nself completion fish >> ~/.config/fish/completions/nself.fish

# Completions include:
# - All commands and subcommands
# - Service names
# - Environment names
# - File paths where relevant
# - Flag values
```

#### Interactive Mode

```bash
nself interactive
# or
nself -i

# ┌─────────────────────────────────────────────────────────────┐
# │ nself interactive mode (type 'help' for commands, 'exit' to quit)
# ├─────────────────────────────────────────────────────────────┤
# │ myapp> status
# │
# │ Services: 12/12 running
# │ Environment: local
# │
# │ myapp> logs api --tail 10
# │ [api] 2026-01-22 10:30:00 GET /users 200
# │ ...
# │
# │ myapp> scale api 3
# │ Scaling api to 3 replicas... done
# │
# │ myapp> exit
# └─────────────────────────────────────────────────────────────┘
```

#### Progress Indicators

```bash
nself build

# ┌─────────────────────────────────────────────────────────────┐
# │ Building myapp                                              │
# ├─────────────────────────────────────────────────────────────┤
# │ [████████████████████████████████████████] 100% Complete    │
# │                                                             │
# │ ✓ Generated docker-compose.yml                              │
# │ ✓ Generated nginx configuration                             │
# │ ✓ Generated SSL certificates                                │
# │ ✓ Built custom service: api                                 │
# │ ✓ Built custom service: worker                              │
# │ ✓ Generated monitoring configuration                        │
# │                                                             │
# │ Build completed in 12.3s                                    │
# └─────────────────────────────────────────────────────────────┘
```

#### Offline Documentation

```bash
nself help deploy
# Shows full documentation even without internet

nself docs
# Opens local documentation server

nself docs deploy
# Opens specific documentation page
```

---

### 4. Comprehensive Testing

#### Test Coverage Goals

| Area | Target | Current |
|------|--------|---------|
| Unit Tests | 90% | TBD |
| Integration Tests | 80% | TBD |
| E2E Tests | 70% | TBD |
| Platform Coverage | 100% | TBD |

#### Test Matrix

```yaml
# .github/workflows/test-full.yml
strategy:
  matrix:
    os: [ubuntu-latest, ubuntu-22.04, macos-latest, macos-13]
    bash: ['3.2', '4.4', '5.1']
    docker: ['24.0', '25.0']
    node: ['18', '20', '22']  # For nself-admin
```

#### Performance Benchmarks

```bash
nself bench internal

# ┌─────────────────────────────────────────────────────────────┐
# │ nself Internal Benchmarks                                   │
# ├─────────────────────────────────────────────────────────────┤
# │ Command          Time      Memory    Baseline    Status     │
# │ ─────────────────────────────────────────────────────────  │
# │ nself init       1.2s      45MB      1.5s        ✓ Faster   │
# │ nself build      3.4s      128MB     4.0s        ✓ Faster   │
# │ nself start      5.2s      256MB     5.0s        ~ Same     │
# │ nself status     0.3s      32MB      0.5s        ✓ Faster   │
# │ nself logs       0.1s      16MB      0.2s        ✓ Faster   │
# └─────────────────────────────────────────────────────────────┘
```

---

### 5. Documentation Updates

#### Documentation Audit

- [ ] All 40+ commands documented
- [ ] All flags and options documented
- [ ] Examples for every command
- [ ] Troubleshooting guides
- [ ] Migration guides from other tools
- [ ] Video tutorials (links)
- [ ] API reference for nself-admin

#### Documentation Structure

```
docs/
├── getting-started/
│   ├── installation.md
│   ├── quickstart.md
│   └── first-project.md
├── commands/
│   ├── index.md
│   └── [command].md (40+ files)
├── guides/
│   ├── deployment/
│   ├── database/
│   ├── monitoring/
│   ├── scaling/
│   └── security/
├── reference/
│   ├── environment-variables.md
│   ├── configuration-files.md
│   └── api-reference.md
├── troubleshooting/
│   ├── common-issues.md
│   ├── debugging.md
│   └── faq.md
└── migration/
    ├── from-docker-compose.md
    ├── from-kubernetes.md
    └── from-heroku.md
```

---

## Implementation Files

### CLI Improvements
```
src/cli/completion.sh        # Shell completions
src/cli/interactive.sh       # Interactive mode
src/lib/utils/progress.sh    # Progress indicators
src/lib/utils/docs.sh        # Offline documentation
```

### Admin Integration
```
src/lib/admin/
├── api.sh                   # Admin API server
├── status.sh                # Status endpoint
├── logs.sh                  # Log streaming
├── metrics.sh               # Metrics endpoint
└── websocket.sh             # WebSocket support
```

### Testing
```
src/tests/
├── unit/
│   └── *.sh                 # Unit tests for all commands
├── integration/
│   └── *.sh                 # Integration tests
├── e2e/
│   └── *.sh                 # End-to-end tests
└── benchmarks/
    └── *.sh                 # Performance benchmarks
```

---

## Success Criteria

1. ✓ All known bugs fixed
2. ✓ Error messages are helpful and actionable
3. ✓ nself-admin shows real-time CLI status
4. ✓ Shell completion works for bash, zsh, fish
5. ✓ Interactive mode is fully functional
6. ✓ All commands have proper progress indicators
7. ✓ Test coverage meets targets
8. ✓ Documentation is complete and accurate
9. ✓ Performance benchmarks pass
10. ✓ Cross-platform testing passes (100%)

---

## Release Checklist

Before tagging v0.4.9:

- [ ] All GitHub issues labeled "v0.4.9" are closed
- [ ] All tests pass on all platforms
- [ ] Documentation is complete
- [ ] CHANGELOG is updated
- [ ] Performance benchmarks pass
- [ ] Security audit completed
- [ ] nself-admin integration tested
- [ ] Shell completions tested
- [ ] Interactive mode tested
- [ ] Offline documentation works

---

*Last Updated: January 22, 2026*
