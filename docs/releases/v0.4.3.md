# nself cli v0.4.3 - Deployment Pipeline

**Release Date**: January 21, 2026
**Status**: Stable
**Type**: Feature Release

---

## Overview

v0.4.3 adds **comprehensive deployment pipeline commands** that streamline multi-environment workflows. New modular libraries for environment management, deployment operations, and security provide a solid foundation for staging and production deployments.

### New Commands

| Command | Purpose |
|---------|---------|
| `nself env` | Environment management (create, switch, diff, validate) |
| `nself deploy` | Enhanced SSH deployment with zero-downtime support |
| `nself prod` | Production deployment shortcut |
| `nself staging` | Staging deployment shortcut |

---

## Features

### Environment Command (`nself env`)

Complete environment management with 10 subcommands.

**Commands**:
- `nself env create <name> [template]` - Create a new environment
- `nself env list` - List all environments
- `nself env switch <name>` - Switch to an environment
- `nself env status` - Show current environment status
- `nself env info [name]` - Show environment details
- `nself env diff <env1> <env2>` - Compare two environments
- `nself env validate [name]` - Validate environment configuration
- `nself env delete <name>` - Delete an environment
- `nself env export <name>` - Export environment configuration
- `nself env import <file>` - Import environment configuration

**Templates**:
- `local` - Local development (default)
- `staging` - Staging environment
- `prod` - Production environment

---

### Deploy Command (`nself deploy`)

Enhanced SSH deployment with new modular architecture.

**Commands**:
- `nself deploy staging` - Deploy to staging
- `nself deploy prod` - Deploy to production
- `nself deploy <env-name>` - Deploy to custom environment
- `nself deploy init` - Initialize deployment configuration
- `nself deploy status` - Show deployment status
- `nself deploy rollback` - Rollback deployment
- `nself deploy logs` - View deployment logs
- `nself deploy webhook` - Setup GitHub webhook
- `nself deploy health` - Check deployment health
- `nself deploy check-access` - Verify SSH access

**Options**:
- `--dry-run` - Preview deployment without executing
- `--force` - Force deployment, skip confirmations
- `--no-backup` - Skip pre-deployment backup
- `--verbose` - Show detailed output

**New Deployment Modules**:
- `ssh.sh` - SSH connection management
- `credentials.sh` - Secure credential handling
- `health-check.sh` - Deployment health verification
- `zero-downtime.sh` - Zero-downtime deployment support

---

### Shortcut Commands

**`nself prod`**:
```bash
nself prod              # Deploy to production
nself prod status       # Check production status
nself prod logs         # View production logs
```

**`nself staging`**:
```bash
nself staging           # Deploy to staging
nself staging status    # Check staging status
nself staging logs      # View staging logs
```

---

## Technical Improvements

### New Library Modules

**Environment Library** (`src/lib/env/`):
- `create.sh` - Environment creation logic
- `switch.sh` - Environment switching
- `diff.sh` - Environment comparison
- `validate.sh` - Configuration validation

**Deployment Library** (`src/lib/deploy/`):
- `ssh.sh` - SSH utilities and connection pooling
- `credentials.sh` - Secure credential management
- `health-check.sh` - Post-deployment health verification
- `zero-downtime.sh` - Blue-green deployment support

**Security Library** (`src/lib/security/`):
- `checklist.sh` - Production security checklist
- `secrets.sh` - Secrets management
- `ssl-letsencrypt.sh` - Let's Encrypt integration
- `firewall.sh` - Firewall configuration helpers

### Bug Fixes

- **nginx-generator.sh**: Fixed variable substitution in nginx config generation
- **Dockerfile Templates**: Fixed 16 JavaScript service templates
  - Corrected volume mount paths for node_modules
  - Fixed WORKDIR and COPY instructions
  - Improved build layer caching
- **Auto-fix System**: Enhanced error detection and recovery
- **Docker Compose Modules**: Fixed custom service template generation
- **Monitoring Exporters**: Fixed exporter service definitions

### Cross-Platform Compatibility

All new commands maintain full compatibility with:
- macOS (Bash 3.2, BSD tools)
- Linux (Bash 4+, GNU tools)
- WSL (Windows Subsystem for Linux)

---

## Upgrade Instructions

### From v0.4.2

This is a feature release with no breaking changes:

```bash
nself update
```

Or manually:

```bash
cd /path/to/nself
git pull origin main
```

### New Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `DEPLOY_SSH_KEY` | `~/.ssh/id_rsa` | SSH key for deployments |
| `DEPLOY_USER` | `deploy` | SSH user for deployments |
| `DEPLOY_TIMEOUT` | `300` | Deployment timeout (seconds) |
| `HEALTH_CHECK_RETRIES` | `30` | Health check retry attempts |

---

## Testing Verification

All changes verified on:

- Ubuntu 22.04 (Bash 5.1, GNU tools)
- macOS (Bash 3.2, BSD tools)
- CI Pipeline (all unit tests passing)

---

## Known Issues

No known issues in v0.4.3.

---

## Roadmap

### v0.4.4 (Next)
- Database operations command (`nself db`)
- Backup/restore commands
- Mock data and seeding tools
- Migration management

### v0.4.5 and Beyond
- Provider support (AWS, GCP, Azure, Hetzner, etc.)
- Scaling commands
- Kubernetes support

---

## Full Changelog

See [CHANGELOG.md](../releases/CHANGELOG.md) for complete history.
