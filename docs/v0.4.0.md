# nself v0.4.0 - Public Release

## Overview
v0.4.0 focuses on polishing and perfecting existing features for a production-ready public release. This version enhances what v0.3.9 introduced and completes partial implementations.

## Release Goals
- **Polish** existing features to production quality
- **Complete** partial implementations
- **Optimize** performance and resource usage
- **Stabilize** for public release

## Feature Enhancements

### 1. Apps Enhancement
Expand existing APP_1 routing to full multi-app support with database isolation.

**Current State**: Basic routing with APP_1, APP_2 environment variables
**Enhancement**: Complete multi-tenant architecture

**New Commands**:
```bash
nself apps create <name>      # Create new app
nself apps list               # List all apps
nself apps switch <name>      # Switch active app
nself apps delete <name>      # Delete app
nself apps config <name>      # Configure app
```

**Features**:
- Database table prefixing (app1_users, app2_products)
- Per-app Hasura metadata and permissions
- Isolated GraphQL schemas per app
- Shared vs app-specific resources
- Cross-app data sharing (optional)
- App-specific environment variables

**Implementation**:
```bash
# Database structure
public/
├── users (global owner user)
├── app1_users
├── app1_posts
├── app1_settings
├── app2_users
├── app2_orders
└── app2_products
```

### 2. Codegen Command
Generate type-safe client code from database schema.

**Commands**:
```bash
nself codegen typescript      # TypeScript interfaces
nself codegen react           # React hooks with SWR
nself codegen graphql         # GraphQL client with types
nself codegen openapi         # OpenAPI 3.0 spec
```

**Features**:
- Full TypeScript types from PostgreSQL schema
- React hooks with SWR/React Query integration
- GraphQL client with complete typing
- Automatic Hasura permissions inclusion
- Watch mode for development
- Custom output directories

**Environment Variables**:
```bash
CODEGEN_OUTPUT_DIR=./generated
CODEGEN_TYPESCRIPT_ENABLED=true
CODEGEN_REACT_ENABLED=false
CODEGEN_WATCH_MODE=false
CODEGEN_INCLUDE_COMMENTS=true
```

### 3. Functions Polish
Complete the existing functions service with production features.

**Current State**: Basic functions container exists
**Enhancement**: Full serverless function platform

**New Commands**:
```bash
nself functions create <name>  # Create function
nself functions list           # List functions
nself functions deploy         # Deploy functions
nself functions logs <name>    # View logs
nself functions test <name>    # Test locally
```

**Features**:
- Node.js runtime (Deno, Python in future)
- Hot reload in development
- Database event triggers
- Scheduled functions (cron)
- HTTP webhook endpoints
- Environment variable injection
- Automatic routing via nginx

**Function Structure**:
```javascript
// functions/hello.js
export default async function(req, context) {
  const { user, db, env } = context;
  return {
    statusCode: 200,
    body: { message: "Hello World" }
  };
}
```

### 4. Monitor Polish
Perfect existing monitoring with full observability stack.

**Current State**: Basic monitoring exists
**Enhancement**: Production-ready observability

**Improvements**:
- Auto-provision Prometheus if not enabled
- Pre-configured Grafana dashboards
- Loki for log aggregation
- Alert rules templates
- Service dependency mapping
- Performance profiling

**New Commands**:
```bash
nself monitor dashboard        # Open Grafana
nself monitor alerts           # Manage alerts
nself monitor export           # Export metrics
```

### 5. Database Polish
Improve existing database commands with better tooling.

**Current State**: Basic db commands work
**Enhancement**: Production database management

**Improvements**:
- Better migration tracking
- Automatic backup before migrations
- Schema diff visualization
- Performance insights
- Index recommendations
- Query optimization tips

**Enhanced Commands**:
```bash
nself db analyze              # Performance analysis
nself db optimize             # Run optimizations
nself db vacuum               # Vacuum database
nself db explain <query>      # Explain query plan
```

### 6. Backup Polish
Perfect existing backup system with better cloud support.

**Current State**: S3 backup works
**Enhancement**: Multi-cloud backup

**Improvements**:
- Support for Backblaze B2
- Google Cloud Storage support
- Azure Blob Storage support
- Incremental backup optimization
- Parallel upload for large backups
- Backup encryption options

**New Providers**:
```bash
BACKUP_PROVIDER=s3       # Existing
BACKUP_PROVIDER=b2       # Backblaze B2
BACKUP_PROVIDER=gcs      # Google Cloud Storage
BACKUP_PROVIDER=azure    # Azure Blob Storage
```

### 7. SSL Polish
Perfect SSL automation for production.

**Current State**: mkcert for local, basic Let's Encrypt
**Enhancement**: Full production SSL automation

**Improvements**:
- Automatic Let's Encrypt for production
- DNS challenge support for wildcards
- Certificate monitoring and alerts
- Auto-renewal with zero downtime
- Multi-domain support
- Certificate backup

**DNS Providers**:
- Cloudflare
- Route53
- DigitalOcean
- Namecheap
- GoDaddy

### 8. Environment Polish
Perfect environment management from v0.3.9 work.

**Improvements**:
- Environment variable validation
- Type checking for env vars
- Required vs optional detection
- Secret leak prevention
- Environment diff tool
- Migration between environments

**New Commands**:
```bash
nself env validate            # Validate current environment
nself env diff <env1> <env2>  # Compare environments
nself env migrate             # Migrate to new environment
```

## Performance Goals
- Functions cold start < 50ms
- Database queries < 10ms p99
- Backup upload > 100MB/s
- SSL renewal < 5 seconds
- Codegen < 3 seconds
- Monitor dashboard < 1 second load

## Testing Requirements
- 100% backward compatibility
- All existing projects must work
- Migration testing from v0.3.x
- Load testing at scale
- Security audit pass
- Documentation complete

## Success Criteria
- [ ] All enhancements complete
- [ ] Performance goals met
- [ ] Zero breaking changes
- [ ] Documentation updated
- [ ] Examples provided
- [ ] Community tested

## Known Limitations
- Functions limited to Node.js (Python/Deno coming)
- Codegen supports TypeScript/React primarily
- Multi-app requires PostgreSQL schemas
- Some features require Docker privileges

---

[Previous: v0.3.9](./v0.3.9.md) | [Next: Beyond](./ROADMAP.md#beyond) | [Roadmap](./ROADMAP.md)