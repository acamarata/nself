# nself v0.3.9 - Feature Complete Platform

## Overview
v0.3.9 transforms nself from a CLI tool into a complete backend platform with admin UI, deployment capabilities, and enterprise search.

## Release Timeline
- **Development Start**: Immediate
- **Target Release**: 5 weeks
- **Type**: Major feature release

## New Features

### 1. Admin UI
Web-based administration interface for visual management.

**Implementation**:
- Separate repository: `github.com/acamarata/nself-admin`
- Docker image: `nself/admin:latest`
- Stack: Next.js 14, TypeScript, Tailwind CSS (Protocol template)
- Mounts host project directory for direct file access

**Commands**:
```bash
nself admin enable        # Enable admin web interface
nself admin disable       # Disable admin web interface  
nself admin status        # Show admin UI status
nself admin password      # Set admin password
nself admin reset         # Reset admin to defaults
nself admin logs          # View admin logs
nself admin open          # Open admin in browser
```

**Features**:
- Real-time service monitoring
- Configuration editor (.env files)
- Service start/stop/restart controls
- Log streaming with filtering
- Database management interface
- Backup management
- SSL certificate status
- Resource usage graphs

**Environment Variables**:
```bash
ADMIN_ENABLED=false
ADMIN_PORT=3100
ADMIN_USERNAME=admin
ADMIN_PASSWORD_HASH=
ADMIN_SECRET_KEY=
ADMIN_SESSION_TIMEOUT=3600
ADMIN_2FA_ENABLED=false
ADMIN_ALLOWED_IPS=
```

### 2. Deploy Command
SSH deployment to VPS with automatic setup.

**Commands**:
```bash
nself deploy init         # Initialize deployment config
nself deploy ssh          # Deploy to VPS via SSH
nself deploy status       # Show deployment status
nself deploy rollback     # Rollback deployment
nself deploy logs         # View deployment logs
nself deploy webhook      # Setup GitHub webhook
```

**Features**:
- SSH key-based authentication
- Automatic Docker installation on target
- Git repository cloning
- Environment compilation (.env.prod + .env.secrets → .env)
- Systemd service setup for auto-start
- Nginx configuration for production
- Let's Encrypt SSL automation
- GitHub webhook for continuous deployment
- Health checks and auto-rollback

**Supported VPS Providers**:
- DigitalOcean
- Linode
- Vultr
- Hetzner
- OVH
- Any Ubuntu/Debian VPS

**Environment Variables**:
```bash
DEPLOY_METHOD=ssh
DEPLOY_HOST=
DEPLOY_USER=root
DEPLOY_KEY_PATH=~/.ssh/id_rsa
DEPLOY_TARGET_DIR=/opt/nself
DEPLOY_WEBHOOK_SECRET=
DEPLOY_AUTO_SSL=true
DEPLOY_BRANCH=main
```

### 3. Init Wizard
Interactive setup wizard for first-time users.

**Command**:
```bash
nself init --wizard       # Interactive setup wizard
```

**Features**:
- Project type detection:
  - SaaS Application
  - E-commerce Platform
  - Blog/CMS
  - API Backend
  - Custom
- Service recommendations based on project type
- Framework detection (Next.js, React, Vue, etc.)
- Database configuration with:
  - Owner user setup (immutable)
  - Initial schema selection
  - Sample data option
- Environment configuration
- Git repository initialization

**Wizard Flow**:
1. Project name and type
2. Required services selection
3. Optional services selection
4. Database configuration
5. Authentication setup
6. Domain configuration
7. Environment selection (dev/staging/prod)
8. Review and confirm

### 4. Search Command
Enterprise search with multiple engine options.

**Commands**:
```bash
nself search enable       # Enable search service
nself search disable      # Disable search service
nself search status       # Search service status
nself search test         # Test search functionality
nself search reindex      # Rebuild search index
```

**Search Engine Options**:
1. **PostgreSQL FTS** (Default) - No extra container
   - Built-in full-text search
   - pg_trgm for typo tolerance
   - Good for most use cases

2. **MeiliSearch** - Best user experience
   - Lightning fast
   - Typo tolerant
   - Faceted search
   - Instant search optimized

3. **Typesense** - Alternative to MeiliSearch
   - Similar features
   - Good performance

4. **Elasticsearch** - Enterprise standard
   - Most powerful
   - Resource intensive
   - Complex queries

5. **OpenSearch** - Open source Elasticsearch
   - AWS maintained
   - Elasticsearch compatible

6. **Sonic** - Lightweight option
   - Minimal resources
   - Fast autocomplete
   - Simple API

**Environment Variables**:
```bash
SEARCH_ENABLED=false
SEARCH_ENGINE=postgres  # postgres, meilisearch, typesense, elasticsearch, opensearch, sonic
SEARCH_HOST=search
SEARCH_PORT=7700
SEARCH_API_KEY=
SEARCH_INDEX_PREFIX=
SEARCH_AUTO_INDEX=true
SEARCH_LANGUAGE=en
```

### 5. Environment Management
Enhanced environment configuration for deployment.

**Features**:
- Environment file hierarchy:
  - `.env.local` - Local development (git-ignored)
  - `.env.dev` - Shared development settings
  - `.env.staging` - Staging configuration
  - `.env.prod` - Production configuration (no secrets)
  - `.env.secrets` - Production secrets (server-only)
- Automatic compilation for deployment
- Variable validation
- Secret detection and warnings
- Environment-specific defaults

**Compilation Rules**:
```bash
# Development
.env.local → used as-is

# Staging
.env.staging + .env.local → compiled .env

# Production
.env.prod + .env.secrets → compiled .env
```

## Implementation Plan

### Week 1: Foundation
- Init wizard implementation
- Environment management system
- Basic deploy structure

### Week 2: Admin UI
- Create nself-admin repository
- Setup Next.js with Protocol template
- Implement core admin features
- Docker integration

### Week 3: Deployment
- SSH deployment implementation
- VPS provider testing
- GitHub webhook system
- Rollback mechanism

### Week 4: Search & Polish
- Search engine integrations
- PostgreSQL FTS setup
- MeiliSearch container
- Command testing

### Week 5: Testing & Release
- Integration testing
- Documentation
- Bug fixes
- Release preparation

## Success Criteria
- [ ] All 5 features working
- [ ] Admin UI loads < 2 seconds
- [ ] Deploy completes < 5 minutes
- [ ] Search responds < 100ms
- [ ] Wizard guides new users successfully
- [ ] All tests passing

## Migration from v0.3.8
- Fully backward compatible
- New features are opt-in
- Existing projects continue working
- Simple upgrade path: `nself update`

## Known Limitations
- Deploy currently supports VPS only (cloud providers in v0.4.0+)
- Admin UI requires Docker volume mount permissions
- Search engines beyond PostgreSQL add extra containers
- Init wizard requires interactive terminal

---

[Next: v0.4.0 - Public Release](./v0.4.0.md) | [Roadmap](./ROADMAP.md)