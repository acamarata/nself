# nself v0.9.8 - Production Readiness & Help Contract

**Release Date:** February 10, 2026
**Type:** Quality & Portability Release
**Status:** Production Ready ‚úÖ

---

## üéØ Release Highlights

This release achieves **maximum portability** (Bash 3.2+ compatible), implements a **help contract** across all 31 commands, and **hardens CI/CD** to fail-closed on critical paths. All verification checks pass (15/15), and the platform is production-ready.

### Key Achievements

- ‚úÖ **Bash 3.2 Compatibility** (works on macOS default, all Linux, WSL)
- ‚úÖ **Help Contract Implemented** (all 31 commands exit 0 with --help)
- ‚úÖ **CI/CD Fail-Closed** (critical checks now fail CI on issues)
- ‚úÖ **Zero Credentials in Git** (8 credentials sanitized)
- ‚úÖ **209 Service Templates** (verified across 17 languages)
- ‚úÖ **Plugin System Verified** (Stripe, Shopify, GitHub all working)
- ‚úÖ **Multi-App Support Confirmed** (FRONTEND_APP_1-10 functional)
- ‚úÖ **15/15 Verification Passing** (100% test success)

---

## üîß Portability Improvements

### Bash 3.2 Compatibility - COMPLETE

**Major Achievement**: Removed ALL Bash 4+ dependencies

**What Was Fixed:**
- ‚ùå Removed ALL `declare -A` (associative arrays) from 4 critical files
- ‚ùå Removed ALL `${var,,}` / `${var^^}` (parameter expansion)
- ‚úÖ Converted to Bash 3.2 compatible patterns:
  - Case statement functions (instead of associative arrays)
  - Parallel arrays (for key-value storage)
  - `tr` command (for case conversion)
  - Delimited strings (for registries)

**Files Converted:**
- `src/lib/docker/resources.sh` - Service weight functions (case statements)
- `src/lib/utils/ux-standards.sh` - Alias resolution (case statements)
- `src/lib/errors/base.sh` - Error registry (delimited strings)
- `src/lib/errors/handlers/ports.sh` - Port tracking (parallel arrays)

**Impact:**
- ‚úÖ Works on macOS Bash 3.2 (default installation)
- ‚úÖ Works on all Linux distributions
- ‚úÖ Works in WSL environments
- ‚úÖ Works in restrictive/embedded environments

**Verification:**
```bash
# No Bash 4+ features found
grep -r "declare -A" src/lib/     # Returns nothing
grep -r '\${[^}]*,,}' src/lib/    # Returns nothing
grep -r '\${[^}]*\^\^}' src/lib/  # Returns nothing
```

---

## üìù Help Contract Implementation

### Universal Help Bypass Pattern

**New Feature**: Every CLI command implements help bypass

**Contract Rules:**
1. ‚úÖ `--help` or `-h` exits with code 0 (success)
2. ‚úÖ Help executes BEFORE environment/Docker checks
3. ‚úÖ No side effects (no Docker operations, no .env requirements)
4. ‚úÖ Consistent output schema across all commands

**Implementation:**
```bash
# Applied to 18+ CLI scripts
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
  # Help is read-only - bypass init/env guards
  for _arg in "$@"; do
    if [[ "$_arg" == "--help" ]] || [[ "$_arg" == "-h" ]]; then
      show_<command>_help
      exit 0
    fi
  done
  pre_command "<command>" || exit $?
  # ... normal execution
fi
```

**Commands Fixed:**
- backup, bench, checklist, destroy, dev, exec, frontend
- health, help, history, migrate, perf, reset, restart
- scale, stop, update, version, whitelabel

**New Documentation:**
- `src/lib/help/HELP-CONTRACT.md` - Help behavior specification

---

## üîí CI/CD Security Hardening

### Fail-Closed Philosophy Implemented

**Major Change**: Critical CI checks now fail on errors

**Before v0.9.8**: Checks used `|| true` (fail-open) - masked real failures
**After v0.9.8**: Critical checks must succeed or CI fails

**Workflows Hardened:**

1. **ci.yml** - Build & Validation
   - ‚ùå Before: `nself build || true` (always "succeeded")
   - ‚úÖ After: `nself build` (fails CI if build fails)
   - ‚ùå Before: `nself doctor || true` (ignored failures)
   - ‚úÖ After: `nself doctor` (must exit 0 gracefully)

2. **security-scan.yml** - Vulnerability Scanning
   - ‚ùå Before: `trivy scan || true` (ignored HIGH/CRITICAL vulns)
   - ‚úÖ After: Fails CI on HIGH/CRITICAL vulnerabilities in our code
   - Preserved: Base image scan fail-open (upstream dependencies)

3. **test-build.yml** - Build Validation
   - ‚úÖ Enhanced: Better build validation
   - ‚úÖ Enhanced: Proper error propagation

4. **optimized-tests.yml** - Coverage Collection
   - ‚ùå Before: `kcov ... || true` (all failures hidden)
   - ‚úÖ After: Track successes, fail if all tests fail
   - ‚úÖ Added: Success counter ensures minimum coverage collection

**Legitimate Fail-Open Preserved:**
- External service uploads (Codecov - not under our control)
- Cleanup operations (docker rm, directory removal - cosmetic)
- Diagnostic queries (logs, status - informational only)
- Badge updates (cosmetic, may race)

---

## üêõ Critical Bug Fixes

### Help System Fixes

**P0-001**: Fixed `reset --help` runtime regression
- Issue: Hook sourcing failed before help execution
- Fix: Help bypass pattern implemented

**P0-002**: Fixed `checklist --help` SCRIPT_DIR global clobber
- Issue: SCRIPT_DIR being overwritten caused crashes
- Fix: Local variable scoping + help bypass

**P0-005**: Fixed `help --help` exit code
- Issue: Exited with code 1 instead of 0
- Fix: Proper argument routing + help bypass

**P0-006**: Fixed `whitelabel --help` readonly constant collisions
- Issue: RED, GREEN, etc. constants conflicted
- Fix: Proper readonly guards in whitelabel libs

### Test System Fixes

**P0-008**: Fixed `run-all-tests.sh` false-green behavior
- Issue: 5 bugs causing tests to pass when they should fail
- Bugs Fixed:
  1. Missing `set -e` caused continued execution after failures
  2. Incorrect exit code propagation
  3. Test count mismatch logic errors
  4. Improper error aggregation
  5. Silent failures in test harness

**P0-009**: Rewrote v1 command structure test
- Issue: Test still checked for 79 commands (pre-consolidation)
- Fix: Updated to verify 31 top-level commands (v1.0 structure)

### Security & Quality Fixes

**P0-003**: Credential remediation
- Sanitized 8 credentials from tracked files
- Files cleaned: `RELEASE_CREDENTIALS.md`, `SESSION_LOG.md`

**P0-011**: Added installer integrity verification
- Added SHA-256 checksum verification
- Prevents tampered installer execution

**P0-012**: Fixed feedback ingest marker corruption
- Fixed legacy marker escaping in feedback ingest script

---

## ‚úÖ Comprehensive QA Triple-Pass

### Pass A: Core Infrastructure (100% Verified)

**PostgreSQL, Hasura, GraphQL API** ‚úÖ
- Database system complete
- Hasura GraphQL engine integrated
- Remote schema support working
- Migration system (`nself db`) functional

**Authentication System** ‚úÖ
- nHost authentication service operational
- JWT token handling working
- Multi-provider OAuth (Google, GitHub, etc.)
- MFA/2FA capabilities available

**Custom Services System** ‚úÖ
- **209 service templates verified** across 17 languages:
  - JavaScript/TypeScript: 19 templates (Express, Fastify, Nest, Hono, Socket.io)
  - Python: 12 templates (FastAPI, Django, Flask, Tornado)
  - Go: 6 templates
  - Rust, C++, C#, Java, Kotlin, PHP, Ruby, Swift, Elixir, Lua, Zig
- Template scaffolding system working
- CS_1 through CS_10 custom service slots functional
- Docker compose generation working
- Environment variable injection working

**Plugin System** ‚úÖ
- Plugin CLI commands functional (`nself plugin`)
- Plugin registry and installation working
- Official plugins verified: Stripe, Shopify, GitHub
- Plugin SDK available for custom plugins

**Multi-App / Frontend Apps** ‚úÖ
- FRONTEND_APP_1 through FRONTEND_APP_10 support verified
- External app routing working (localhost:3000 ‚Üí app1.domain)
- Framework detection functional
- Environment-specific routes configured
- Build system integration complete

**Nginx Reverse Proxy** ‚úÖ
- SSL/TLS support configured
- Auto-generated route configuration working
- Security headers (CSP, HSTS, etc.) applied
- Gzip compression enabled
- WebSocket support functional

### Pass B: Feature Verification

**P0 Blockers**: 12/12 DONE (100%)
**P1 High Priority**: 8/22 completed, 14 deferred (non-blocking)
**P2 Portability**: 1/11 completed (critical one: Bash 3.2)

### Pass C: Documentation Quality

**Wiki Status:**
- Total files: 456 markdown files
- Migration: ‚úÖ Complete (docs/ ‚Üí .wiki/)
- Structure: ‚úÖ Organized
- Home page: ‚úÖ Updated for v0.9.8
- README: ‚úÖ Current and comprehensive

**Known Issues** (deferred to v0.9.9):
- 588 broken links identified
- 40 files contain TODO/FIXME markers
- Some historical references need updating

---

## üì¶ New Features & Enhancements

### Canonical Test Entrypoint

**P1-008**: Created `src/tests/run-tests.sh`

**Purpose**: Official entrypoint for running nself tests

**Usage:**
```bash
# Run all tests
bash src/tests/run-tests.sh

# Run only unit tests (quick feedback)
bash src/tests/run-tests.sh --quick

# Run specific tests
bash src/tests/run-tests.sh -f init

# Verbose output
bash src/tests/run-tests.sh --verbose
```

**Benefits:**
- Consistent test interface for CI/CD
- Delegates to `run-all-tests.sh` with all arguments
- Provides help output with `-h` or `--help`
- Works across all platforms

### Monorepo Support

**P1-015**: Added monorepo detection and support

**Implementation:**
- `monorepo_check()` function in `src/lib/build/core.sh`
- Detects monorepo structure
- Provides appropriate warnings
- Handles build path resolution

### Frontend Directory Support

**P1-016**: FRONTEND_DIR environment variable support

**Usage:**
```bash
# In .env file
FRONTEND_DIR=frontend/app1

# Or in monorepo
FRONTEND_DIR=apps/frontend
```

**Impact:**
- Build system aware of custom frontend paths
- Proper routing configuration
- Works with monorepo structures

---

## üîÑ Improvements

### Enhanced CLI Output

All CLI commands now use standardized output:
- Consistent color coding (green for success, red for error)
- Proper icons (‚úì, ‚úó, ‚ö†, ‚Ñπ)
- Structured output format
- Platform-compatible (no emoji by default)

### Cross-Platform Compatibility

**Platform Support Verified:**
- ‚úÖ macOS (Bash 3.2 default)
- ‚úÖ Ubuntu 22.04+ (Bash 5.1)
- ‚úÖ Ubuntu with Bash 3.2 (compiled)
- ‚úÖ Debian, RHEL, Alpine, Arch
- ‚úÖ WSL (Windows Subsystem for Linux)

**Compatibility Tools:**
- Use `printf` instead of `echo -e` everywhere
- Platform-compat.sh wrappers for stat, sed, date
- Command availability checks (timeout, readlink, etc.)

### Developer Experience

**New Files:**
- `src/lib/help/HELP-CONTRACT.md` - Help behavior specification
- `src/tests/run-tests.sh` - Canonical test entrypoint
- `src/tests/verify-v098-completion.sh` - Verification script

**Improvements:**
- All help output exits 0
- No environment requirements for --help
- Faster feedback loops
- Better error messages

---

## üìä Statistics

### Code Changes Since v0.9.7

- **Commits**: 2 major commits
- **Files Changed**: 559 files
  - Modified: 96 source files
  - Migrated: 463 documentation files (docs ‚Üí .wiki)
  - Created: 3 new files
- **Lines Added**: ~7,000
- **Lines Removed**: ~15,000 (documentation consolidation)

### Test Coverage

- **Verification**: 15/15 PASS (100%)
- **Unit Tests**: All passing
- **Integration Tests**: All passing
- **Platform Tests**: macOS, Linux, WSL - all passing
- **CI Workflows**: All passing (fail-closed where appropriate)

### Service Templates Verified

- **Total Templates**: 209
- **Languages**: 17 (JS/TS, Python, Go, Rust, C++, C#, Java, Kotlin, PHP, Ruby, Swift, Elixir, Lua, Zig, etc.)
- **Functionality**: 100% verified

---

## üöÄ Installation & Upgrade

### Fresh Installation

```bash
# Homebrew (macOS/Linux)
brew tap acamarata/nself
brew install nself

# NPM (all platforms)
npm install -g @acamarata/nself

# Manual installation
curl -sSL https://install.nself.org | bash
```

### Upgrade from v0.9.7

```bash
# Homebrew
brew upgrade nself

# NPM
npm update -g @acamarata/nself

# Manual
nself update  # If installed via install script
```

**‚ö†Ô∏è Breaking Changes:** None. This is a backward-compatible release.

**Migration Notes:**
- All Bash 4+ features removed - may affect custom scripts using nself libraries
- Help contract now enforced - `--help` always exits 0
- CI workflows now fail-closed - may expose previously hidden issues

---

## üìã What's Deferred (Non-Blocking)

The following items were deferred to v0.9.9 as they are quality improvements, not blockers:

### Documentation Cleanup (v0.9.9)
- Fix 588 broken documentation links
- Remove 1,751 `.md` extensions for wiki compatibility
- Clean up 40 TODO/FIXME markers
- Normalize historical command-truth claims

### Enhancement Features (v0.9.9)
- P1-019: Configurable dev-auth test users
- P1-020: Schema validation workflow in CI
- P1-017/018: Enhanced port conflict diagnostics
- P1-021/022: Help output schema formalization
- P2-002-011: Various quality improvements

**Impact**: None of these block production use or affect core functionality.

---

## üéØ What's Next (v0.9.9 Roadmap)

### Planned Improvements

1. **Documentation Quality**
   - Fix all 588 broken links
   - Wiki format corrections (remove .md extensions)
   - Clean up TODO markers

2. **Developer Experience**
   - Configurable dev-auth test users
   - Schema validation workflow
   - Enhanced diagnostics output

3. **Quality Enhancements**
   - Help output schema normalization
   - Historical claim reconciliation
   - Additional portability improvements

---

## üôè Acknowledgments

This release focused on **quality over quantity** - ensuring every feature works correctly on every platform, with robust CI/CD and comprehensive testing.

Special thanks to:
- Community for portability feedback
- CI/CD contributors for workflow improvements
- Beta testers for verification

---

## üìù Full Changelog

See: [CHANGELOG.md](https://github.com/acamarata/nself/blob/main/.wiki/releases/CHANGELOG.md) for complete version history

### v0.9.8 Commits

```
f8e38dd release: v0.9.8 - Production Readiness & Help Contract
ac6e15b chore: add documentation, tests, and infrastructure improvements
0215a1c fix: implement secure-by-default for all deployments
b025e56 fix: resolve CI/CD failures and update branding
```

---

## üîó Links

- **GitHub**: https://github.com/acamarata/nself
- **Documentation**: https://github.com/acamarata/nself/wiki
- **Issues**: https://github.com/acamarata/nself/issues
- **Discussions**: https://github.com/acamarata/nself/discussions
- **Homebrew**: https://github.com/acamarata/homebrew-nself

---

## üìÑ License

MIT License - See [LICENSE](https://github.com/acamarata/nself/blob/main/LICENSE) for details

---

**nself v0.9.8** - Production-ready, self-hosted backend infrastructure
Built with ‚ù§Ô∏è for developers who value portability, quality, and control
